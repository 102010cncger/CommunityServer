/*
(c) Copyright Ascensio System SIA 2010-2014

This program is a free software product.
You can redistribute it and/or modify it under the terms 
of the GNU Affero General Public License (AGPL) version 3 as published by the Free Software
Foundation. In accordance with Section 7(a) of the GNU AGPL its Section 15 shall be amended
to the effect that Ascensio System SIA expressly excludes the warranty of non-infringement of 
any third-party rights.

This program is distributed WITHOUT ANY WARRANTY; without even the implied warranty 
of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For details, see 
the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html

You can contact Ascensio System SIA at Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021.

The  interactive user interfaces in modified source and object code versions of the Program must 
display Appropriate Legal Notices, as required under Section 5 of the GNU AGPL version 3.
 
Pursuant to Section 7(b) of the License you must retain the original Product logo when 
distributing the program. Pursuant to Section 7(e) we decline to grant you any rights under 
trademark law for use of our trademarks.
 
All the Product's GUI elements, including illustrations and icon sets, as well as technical writing
content are licensed under the terms of the Creative Commons Attribution-ShareAlike 4.0
International. See the License terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
*/

window.DefaultMobile=(function(a){if(!a){console.log("Default.default : has no DefaultMobile");return a}function b(f){var g={commenttype:f.find("input.comment-type:first").removeClass("error-field").val(),id:f.find("input.comment-id:first").removeClass("error-field").val(),parentid:f.find("input.comment-parentid:first").removeClass("error-field").val(),subject:f.find("input.comment-subject:first").removeClass("error-field").val(),content:f.find("textarea.comment-content:first").removeClass("error-field").val()};for(var i in g){if(g.hasOwnProperty(i)){switch(i){case"subject":continue}g[i]=TeamlabMobile.verificationValue(g[i])}}g.parentid=g.parentid?g.parentid:"00000000-0000-0000-0000-000000000000";var h=[];for(var i in g){if(g.hasOwnProperty(i)){if(g[i]!==null){continue}switch(i){case"commenttype":h.push(f.find("input.comment-type:first").addClass("error-field"));break;case"id":h.push(f.find("input.comment-id:first").addClass("error-field"));break;case"content":h.push(f.find("textarea.comment-content:first").addClass("error-field"));break}}}if(h.length===0){return g}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}function e(f){var g={projectid:f.find("div.taskform-select-projectid:first").removeClass("error-field").find("select").val(),milestoneid:f.find("select.task-milestoneid:first").removeClass("error-field").val(),responsible:f.find("select.task-responsibleid:first").removeClass("error-field").val(),description:f.find("textarea.task-description:first").removeClass("error-field").val()||"",deadline:f.find("input.task-deadline:first").removeClass("error-field").scroller("getDate"),title:f.find("input.task-title:first").removeClass("error-field").val()||""};g.deadline=TeamlabMobile.verificationDate(g.deadline);for(var i in g){if(g.hasOwnProperty(i)){switch(i){case"deadline":case"description":continue}g[i]=TeamlabMobile.verificationValue(g[i])}}if(g.milestoneid===null){delete g.milestoneid}if(g.responsible===null){delete g.responsible}var h=[];for(var i in g){if(g.hasOwnProperty(i)){if(g[i]!==null){continue}switch(i){case"projectid":h.push(f.find("div.taskform-select-projectid:first").addClass("error-field"));break;case"description":h.push(f.find("textarea.task-description:first").addClass("error-field"));break;case"deadline":h.push(f.find("input.task-deadline:first").addClass("error-field"));break;case"title":h.push(f.find("input.task-title:first").addClass("error-field"));break}}}if(h.length===0){return g}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}function d(f){var g={projectid:f.find("select.milestone-projectid:first").removeClass("error-field").val(),description:f.find("textarea.milestone-description:first").removeClass("error-field").val()||"",deadline:f.find("input.milestone-deadline:first").removeClass("error-field").scroller("getDate"),title:f.find("input.milestone-title:first").removeClass("error-field").val()||""};g.deadline=TeamlabMobile.verificationDate(g.deadline);for(var i in g){if(g.hasOwnProperty(i)){switch(i){case"description":continue}g[i]=TeamlabMobile.verificationValue(g[i])}}var h=[];for(var i in g){if(g.hasOwnProperty(i)){if(g[i]!==null){continue}switch(i){case"projectid":h.push(f.find("select.milestone-projectid:first").addClass("error-field"));break;case"deadline":h.push(f.find("input.milestone-deadline:first").addClass("error-field"));break;case"title":h.push(f.find("input.milestone-title:first").addClass("error-field"));break}}}if(h.length===0){return g}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}function c(f){var g={projectid:f.find("select.discussion-projectid:first").removeClass("error-field").val(),content:f.find("textarea.discussion-text:first").removeClass("error-field").val()||"",title:f.find("input.discussion-title:first").removeClass("error-field").val()||""};for(var i in g){if(g.hasOwnProperty(i)){g[i]=TeamlabMobile.verificationValue(g[i])}}var h=[];for(var i in g){if(g.hasOwnProperty(i)){if(g[i]!==null){continue}switch(i){case"projectid":h.push(f.find("select.discussion-projectid:first").addClass("error-field"));break;case"content":h.push(f.find("textarea.discussion-text:first").addClass("error-field"));break;case"title":h.push(f.find("input.discussion-title:first").addClass("error-field"));break}}}if(h.length===0){return g}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}a.load_closed_tasks=function(i,h,f){var g=f.parents("li.milestone-item:first");if(!g.hasClass("loading-closed-items")){var k=f.attr("data-projectid"),j=f.attr("data-milestoneid");if(k&&j&&TeamlabMobile.getProjectsClosedTasks(k,j)){g.addClass("loading-closed-items")}}};a.add_projects_milestone_comment=function(i,g,f){var h=b(g);if(h&&TeamlabMobile.addProjectsComment("milestone",h.id,h)){jQuery(document).trigger("changepage");f.addClass("disabled")}};a.add_projects_task_comment=function(i,g,f){var h=b(g);if(h&&TeamlabMobile.addProjectsComment("task",h.id,h)){jQuery(document).trigger("changepage");f.addClass("disabled")}};a.add_projects_discussion_comment=function(i,g,f){var h=b(g);if(h&&TeamlabMobile.addProjectsComment("discussion",h.id,h)){jQuery(document).trigger("changepage");f.addClass("disabled")}};a.add_projects_task=function(i,g,f){var h=e(g);if(h&&TeamlabMobile.addProjectsItem("task",h.projectid,h)){jQuery(document).trigger("changepage");f.addClass("disabled")}};a.add_projects_milestone=function(i,g,f){var h=d(g);if(h&&TeamlabMobile.addProjectsItem("milestone",h.projectid,h)){jQuery(document).trigger("changepage");f.addClass("disabled")}};a.add_projects_discussion=function(i,g,f){var h=c(g);if(h&&TeamlabMobile.addProjectsItem("discussion",h.projectid,h)){jQuery(document).trigger("changepage");f.addClass("disabled")}};a.taskform_select_projectid=function(h,f,g){var i=f.find("select.task-projectid:first").val()||-1;if(!i||i==-1){f.find("select.task-responsibleid").addClass("disabled").val(-1).attr("disabled",true);f.find("select.task-milestoneid").addClass("disabled").val(-1).attr("disabled",true)}else{f.addClass("projectteam-loading").addClass("projectmilestones-loading");f.find("select.task-responsibleid").parent("div.custom-select:first").remove();f.find("select.task-responsibleid").remove();f.find("select.task-milestoneid").parent("div.custom-select:first").remove();f.find("select.task-milestoneid").remove();TeamlabMobile.updateProjectsTaskFormData(i)}};a.update_projects_task_status=function(h,g,f){var i=f.attr("data-itemid");if(i){g.addClass("update-status");f.parents("li.item.:first").addClass("update-status");TeamlabMobile.updateProjectsTaskStatus(i,!f.is(":checked"))}};return a})(DefaultMobile);(function(a){TeamlabMobile.bind(TeamlabMobile.events.projectsPage,s);TeamlabMobile.bind(TeamlabMobile.events.myTasksPage,q);TeamlabMobile.bind(TeamlabMobile.events.projectPage,r);TeamlabMobile.bind(TeamlabMobile.events.projectTasksPage,t);TeamlabMobile.bind(TeamlabMobile.events.teamPage,v);TeamlabMobile.bind(TeamlabMobile.events.projectDocumentsPage,m);TeamlabMobile.bind(TeamlabMobile.events.milestonesPage,p);TeamlabMobile.bind(TeamlabMobile.events.discussionsPage,k);TeamlabMobile.bind(TeamlabMobile.events.taskPage,u);TeamlabMobile.bind(TeamlabMobile.events.projectDocumentPage,l);TeamlabMobile.bind(TeamlabMobile.events.milestonePage,o);TeamlabMobile.bind(TeamlabMobile.events.discussionPage,j);TeamlabMobile.bind(TeamlabMobile.events.addTaskPage,i);TeamlabMobile.bind(TeamlabMobile.events.addMilestonePage,g);TeamlabMobile.bind(TeamlabMobile.events.addDiscussionPage,e);TeamlabMobile.bind(TeamlabMobile.events.addTask,h);TeamlabMobile.bind(TeamlabMobile.events.addMilestone,f);TeamlabMobile.bind(TeamlabMobile.events.addDiscussion,d);TeamlabMobile.bind(TeamlabMobile.events.updateTask,w);TeamlabMobile.bind(TeamlabMobile.events.updateTaskForm,x);TeamlabMobile.bind(TeamlabMobile.events.getProjectClosedTasks,n);TeamlabMobile.bind(TeamlabMobile.events.addProjectsComment,c);function b(y,z){var A=y.attr("data-lowtitle");var B=z.length;while(B--){if(A>z[B].getAttribute("data-lowtitle")){a(z[B]).after(y);break}}}function c(B,C){var z=a();var A=B;if(C.hasOwnProperty("type")){switch(C.type){case"task":z=a("div.page-projects-task.ui-page-active:first");break;case"milestone":z=a("div.page-projects-milestone-tasks.ui-page-active:first");break;case"discussion":z=a("div.page-projects-discussion.ui-page-active:first");break}}if(z.length===0){return undefined}B={comments:[B]};var y=z.find("ul.ui-item-comments:first");if(A.parentId){y.find('li.item-comment[data-commentid="'+A.parentId+'"]:first ul.inline-comments:first').append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbcomments,B))}else{y.append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbcomments,B))}jQuery(document).trigger("updatepage")}function s(z){z={pagetitle:ASC.Resources.LblProjectsTitle,type:"projects-page",onetype:z.mine.length===0||z.other.length===0,mineitems:z.mine,otheritems:z.other};var y=DefaultMobile.renderPage("projects-page","page-projects","projects",ASC.Resources.LblMyProjects,z).addClass("filter-none")}function r(z,F){var B=null,C=null,D=0,A=0,E=0;E=0;C=z.tasks;D=C?C.length:0;while(D--){if(C[D].isOpened===true){E+=1}}A=0;C=z.documents;D=C?C.length:0;while(D--){B=C[D];if(B.type==="file"){A++}else{if(B.type==="folder"){A+=B.filesCount}}}z={item:z,pagetitle:z.title,milestonescount:z.milestones?z.milestones.length:0,discussionscount:z.discussions?z.discussions.length:0,personscount:z.persons?z.persons.length:0,taskscount:z.tasks?E:0,documentscount:z.documents?A:0};var y=DefaultMobile.renderPage("projects-project-page","page-projects-project","projects-project-"+z.item.id,"Project",z)}function q(z){z={pagetitle:ASC.Resources.LblMyTasks,type:"projects-page-tasks",items:z.opened,closeditems:z.closed,projid:-1,milsid:-1};var y=DefaultMobile.renderPage("projects-tasks-page","page-projects-tasks","projects-project-tasks",ASC.Resources.LblMyTasks,z).addClass("filter-tasks")}function t(C,z,A,B){z={pagetitle:C.title,type:"projects-page-tasks",items:z,projid:C.id,security:C.security};var y=DefaultMobile.renderPage("projects-tasks-page","page-projects-project-tasks","projects-project-tasks",ASC.Resources.LblMyTasks,z).addClass("filter-tasks")}function u(z,A){z={pagetitle:z.projectTitle,title:ASC.Resources.LblProjectsTitle,back:null,item:z};if(A.hasOwnProperty("back")&&A.back){z.back=A.back}var y=DefaultMobile.renderPage("projects-task-page","page-projects-task","projects-task-"+z.item.id," ",z)}function p(G,A,F){var B=null,C=A,D=0,z=[],E=[];D=C.length;while(D--){B=C[D];B.status==0?E.push(B):z.push(B)}A={pagetitle:G.title,type:"projects-page-milestones",items:E,closeditems:z,projid:G.id,security:G.security};var y=DefaultMobile.renderPage("projects-milestones-page","page-projects-project-milestones","projects-project-milestones","My milestones",A).addClass("filter-milestones")}function o(z,A){z={pagetitle:z.title,type:"projects-page-tasks",item:z};var y=DefaultMobile.renderPage("projects-tasks-page","page-projects-milestone-tasks","projects-project-tasks",ASC.Resources.LblMyTasks,z).addClass("filter-milestone-tasks")}function k(B,z,A){z={pagetitle:B.title,type:"projects-page-discussions",items:z,projid:B.id,security:B.security};var y=DefaultMobile.renderPage("projects-discussions-page","page-projects-project-discussions","projects-project-discussions",ASC.Resources.LblMyDiscussions,z).addClass("filter-discussions")}function j(z,A){z={pagetitle:z.title,title:ASC.Resources.LblProjectsTitle,item:z};var y=DefaultMobile.renderPage("projects-discussion-page","page-projects-discussion","projects-discussion-"+z.item.id,ASC.Resources.LblMyDiscussions,z)}function v(B,z,A){z={pagetitle:B.title,type:"projects-page-team",items:z,projid:B.id,security:B.security,isSinglePersone:z.length===1};var y=DefaultMobile.renderPage("projects-team-page","page-projects-project-team","projects-project-team",ASC.Resources.LblMyTeam,z).addClass("filter-team")}function m(z,B,C,A,F,E,D){z={pagetitle:A,type:"projects-page-documents",id:B,parent:C,rootfoldertype:F,permissions:D,items:z};var y=DefaultMobile.renderPage("projects-files-page","page-projects-project-files","projects-project-files",ASC.Resources.LblMyFiles,z).addClass("filter-documents")}function l(z,A){z={pagetitle:z.filename,type:"projects-page-documents-item",item:z,filetype:z.filetype,folderid:z.folderId,back:null};if(A.hasOwnProperty("back")&&A.back){z.back=A.back}var y=DefaultMobile.renderPage("documents-item-page","page-documents-file","documents-file",ASC.Resources.LblDocumentsTitle,z)}function i(C,A,B,z,D){data={pagetitle:ASC.Resources.LblProjectsTitle,title:" ",type:"projects-addtask",projid:C,milsid:A,projects:B,milestones:z,responsibles:D};var y=DefaultMobile.renderPage("projects-addtask-page","page-projects-addtask","projects-addtask"+Math.floor(Math.random()*1000000)," ",data)}function g(A,z){data={pagetitle:ASC.Resources.LblProjectsTitle,title:" ",projid:A,type:"projects-addmilestone",projects:z};var y=DefaultMobile.renderPage("projects-addmilestone-page","page-projects-addmilestone","projects-addmilestone"+Math.floor(Math.random()*1000000)," ",data)}function e(A,z){data={pagetitle:ASC.Resources.LblProjectsTitle,title:" ",projid:A,type:"projects-adddiscussion",projects:z};var y=DefaultMobile.renderPage("projects-adddiscussion-page","page-projects-adddiscussion","projects-adddiscussion"+Math.floor(Math.random()*1000000)," ",data)}function h(y){var A=y.hasOwnProperty("id")?y.id:null;if(A){var z=TeamlabMobile.anchors.task+A;ASC.Controls.AnchorController.lazymove({back:ASC.Controls.AnchorController.getLastAnchor()},z.length===0||z==="/"?"#":z)}}function f(y){var A=y.hasOwnProperty("id")?y.id:null;if(A){var z=TeamlabMobile.anchors.milestone+A;ASC.Controls.AnchorController.lazymove(z.length===0||z==="/"?"#":z)}}function d(y){var z=y.hasOwnProperty("id")?y.id:null;if(z){var A=TeamlabMobile.anchors.discussion+z;ASC.Controls.AnchorController.lazymove(A.length===0||A==="/"?"#":A)}}function x(A,y,z){$page=a("div.page-projects-additem-task.ui-page-active:first").removeClass("projectteam-loading").removeClass("projectmilestones-loading");$page.find("div.task-item-container.item-milestoneid:first").append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbprojmilestones,{items:y,classname:"task-milestoneid"}));$page.find("div.task-item-container.item-responsibleid:first").append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbprojteam,{items:z,classname:"task-responsibleid"}));jQuery(document).trigger("updatepage")}function n(D,B,A,C){A={items:A};var y=a('input[value="'+B+'"]:first').parents("li.milestone-item:first");if(y.length>0){var z=y.parents("div.ui-page.ui-page-active:first");y.removeClass("loading-closed-items").addClass("loaded-closed-items").find("ul.milestone-tasks:first").append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbtasks,A));if(y.find('li[data-isclosed="0"]').length===0||y.find('li[data-isclosed="1"]').length===0){y.find("ul.timeline-tasks:first").addClass("one-type")}else{y.find("ul.timeline-tasks:first").removeClass("one-type")}DefaultMobile.renderCheckbox(z);jQuery(document).trigger("updatepage")}}function w(K,J,H,I){var F=null,z=a(),B=null,y=null,C=null;F=a('div.page-projects-task[data-itemid="'+K+'"]').removeClass("update-status");if(F.length>0){z=z.add(F.find("input.input-checkbox.item-status"))}F=a("div.page-projects").removeClass("update-status");if(F.length>0){z=z.add(F.find('li.item.task[data-itemid="'+K+'"] input.input-checkbox.item-status'))}z.parents("li.item").removeClass("update-status");var D=null,E=null,A=null,G=0;G=z.length;while(G--){y=a(z[G]);C=a('label[for="'+z[G].id+'"]');switch(I.toLowerCase()){case"open":y.attr("checked",false);C.removeClass("checked");B=y.parents("li.item:first");if(B.length>0){B.attr("data-isclosed","0");E=B.siblings('li[data-isclosed="0"]');A=B.siblings('li[data-isclosed="1"]');B.parent().prepend(B);if(A.length===0){B.parent().addClass("one-type")}else{B.parent().removeClass("one-type")}b(B,E)}break;case"closed":y.attr("checked",true);C.addClass("checked");B=y.parents("li.item:first");if(B.length>0){B.attr("data-isclosed","1");B.parent().parent().removeClass("no-closed-items");if((D=B.parents("li.milestone-item:first")).length>0){if(!D.hasClass("loaded-closed-items")){B.remove();continue}}E=B.siblings('li[data-isclosed="0"]');A=B.siblings('li[data-isclosed="1"]');B.siblings("li.item-separator").after(B);if(E.length===0){B.parent().addClass("one-type")}else{B.parent().removeClass("one-type")}b(B,A)}break}}}})(jQuery);