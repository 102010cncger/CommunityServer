/*
 * jQuery MobiScroll v1.0beta
 * http://code.google.com/p/mobiscroll/
 *
 * Copyright 2010, Acid Media
 * Licensed under the MIT license.
 *
 */
(function(a){function p(x,m,z){var B=this;var x=x;var m=m;var C;var y;var h;var A=false;this.settings=z;this.values=null;this.val=null;this.temp=null;this.setDefaults=function(D){a.extend(c,D)};this.formatDate=function(G,D,N){if(!D){return null}var M=a.extend({},this.settings,N);var K=function(O){var P=0;while(I+1<G.length&&G.charAt(I+1)==O){P++;I++}return P};var E=function(P,R,O){var Q=""+R;if(K(P)){while(Q.length<O){Q="0"+Q}}return Q};var F=function(P,R,Q,O){return(K(P)?O[R]:Q[R])};var L="";var J=false;for(var I=0;I<G.length;I++){if(J){if(G.charAt(I)=="'"&&!K("'")){J=false}else{L+=G.charAt(I)}}else{switch(G.charAt(I)){case"d":L+=G.charAt(I+1)==="d"?E("d",D.getDate(),2):D.getDate();break;case"D":L+=F("D",D.getDay(),M.dayNamesShort,M.dayNames);break;case"o":L+=E("o",(D.getTime()-new Date(D.getFullYear(),0,0).getTime())/86400000,3);break;case"m":L+=G.charAt(I+1)==="m"?E("m",D.getMonth()+1,2):D.getMonth()+1;break;case"M":L+=F("M",D.getMonth(),M.monthNamesShort,M.monthNames);break;case"y":L+=(K("y")?D.getFullYear():(D.getYear()%100<10?"0":"")+D.getYear()%100);break;case"h":var H=D.getHours();L+=E("h",(H>12?(H-12):(H==0?12:H)),2);break;case"H":L+=E("H",D.getHours(),2);break;case"i":L+=E("i",D.getMinutes(),2);break;case"s":L+=E("s",D.getSeconds(),2);break;case"a":L+=D.getHours()>11?"pm":"am";break;case"A":L+=D.getHours()>11?"PM":"AM";break;case"'":if(K("'")){L+="'"}else{J=true}break;default:L+=G.charAt(I)}}}return L};this.parseDate=function(K,X,W){var H=new Date();if(!K||!X){return H}X=(typeof X=="object"?X.toString():X+"");var U=a.extend({},this.settings,W);var Y=H.getFullYear();var T=H.getMonth();var G=H.getDate();var J=-1;var N=H.getHours();var S=H.getMinutes();var V=H.getSeconds();var D=0;var Q=false;var R=function(Z){var aa=(O+1<K.length&&K.charAt(O+1)==Z);if(aa){O++}return aa};var M=function(aa){R(aa);var ac=(aa=="@"?14:(aa=="!"?20:(aa=="y"?4:(aa=="o"?3:2))));var Z=new RegExp("^\\d{1,"+ac+"}");var ab=X.substring(P).match(Z);if(!ab){throw"Missing number at position "+P}P+=ab[0].length;return parseInt(ab[0],10)};var L=function(ab,ad,aa){var ac=(R(ab)?aa:ad);for(var Z=0;Z<ac.length;Z++){if(X.substr(P,ac[Z].length).toLowerCase()==ac[Z].toLowerCase()){P+=ac[Z].length;return Z+1}}throw"Unknown name at position "+P};var E=function(){if(X.charAt(P)!=K.charAt(O)){throw"Unexpected literal at position "+P}P++};var P=0;for(var O=0;O<K.length;O++){if(Q){if(K.charAt(O)=="'"&&!R("'")){Q=false}else{E()}}else{switch(K.charAt(O)){case"d":G=M("d");break;case"D":L("D",U.dayNamesShort,U.dayNames);break;case"o":J=M("o");break;case"m":T=M("m");break;case"M":T=L("M",U.monthNamesShort,U.monthNames);break;case"y":Y=M("y");break;case"H":N=M("H");break;case"h":N=M("h");break;case"i":S=M("i");break;case"s":V=M("s");break;case"a":D=L("a",["am","pm"],["am","pm"])-1;break;case"A":D=L("A",["am","pm"],["am","pm"])-1;break;case"'":if(R("'")){E()}else{Q=true}break;default:E()}}}if(Y<100){Y+=new Date().getFullYear()-new Date().getFullYear()%100+(Y<=U.shortYearCutoff?0:-100)}if(J>-1){T=1;G=J;do{var I=32-new Date(Y,T-1,32).getDate();if(G<=I){break}T++;G-=I}while(true)}if(D&&N<12){N+=12}var F=new Date(Y,T-1,G,N,S,V);if(F.getFullYear()!=Y||F.getMonth()+1!=T||F.getDate()!=G){throw"Invalid date"}return F};this.setValue=function(D){if(D==undefined){D=true}var E=this.formatResult();this.val=E;this.values=this.temp.slice(0);if(D&&a(x).is("input")){a(x).val(E).attr("data-value",E).change()}};this.getDate=function(){var D=this.values;var F=this.settings;if(F.preset=="date"){return new Date(D[C],D[y],D[h])}if(F.preset=="time"){var E=(F.ampm&&D[F.seconds?3:2]=="PM"&&(D[0]-0)<12)?(D[0]-0+12):D[0];return new Date(1970,0,1,E,D[1],F.seconds?D[2]:null)}if(F.preset=="datetime"){var E=(F.ampm&&D[F.seconds?6:5]=="PM"&&(D[3]-0)<12)?(D[3]-0+12):D[3];return new Date(D[C],D[y],D[h],E,D[4],F.seconds?D[5]:null)}};this.setDate=function(D,F){var G=this.settings;if(G.preset.match(/date/i)){this.temp[C]=D.getFullYear();this.temp[y]=D.getMonth();this.temp[h]=D.getDate()}if(G.preset=="time"){var E=D.getHours();this.temp[0]=(G.ampm)?(E>12?(E-12):(E==0?12:E)):E;this.temp[1]=D.getMinutes();if(G.seconds){this.temp[2]=D.getSeconds()}if(G.ampm){this.temp[G.seconds?3:2]=E>11?"PM":"AM"}}if(G.preset=="datetime"){var E=D.getHours();this.temp[3]=(G.ampm)?(E>12?(E-12):(E==0?12:E)):E;this.temp[4]=D.getMinutes();if(G.seconds){this.temp[2]=D.getSeconds()}if(G.ampm){this.temp[G.seconds?6:5]=E>11?"PM":"AM"}}this.setValue(F)};this.parseValue=function(I){var H=this.settings;if(this.preset){var G=[];if(H.preset=="date"){try{var D=this.parseDate(H.dateFormat,I,H)}catch(E){var D=new Date()}G[C]=D.getFullYear();G[y]=D.getMonth();G[h]=D.getDate()}else{if(H.preset=="time"){try{var D=this.parseDate(H.timeFormat,I,H)}catch(E){var D=new Date()}var F=D.getHours();G[0]=(H.ampm)?(F>12?(F-12):(F==0?12:F)):F;G[1]=D.getMinutes();if(H.seconds){G[2]=D.getSeconds()}if(H.ampm){G[H.seconds?3:2]=F>11?"PM":"AM"}}else{if(H.preset=="datetime"){try{var D=this.parseDate(H.dateFormat+" "+H.timeFormat,I,H)}catch(E){var D=new Date()}var F=D.getHours();G[C]=D.getFullYear();G[y]=D.getMonth();G[h]=D.getDate();G[3]=(H.ampm)?(F>12?(F-12):(F==0?12:F)):F;G[4]=D.getMinutes();if(H.seconds){G[5]=D.getSeconds()}if(H.ampm){G[H.seconds?6:5]=F>11?"PM":"AM"}}}}return G}return H.parseValue(I)};this.formatResult=function(){var F=this.settings;var D=this.temp;if(this.preset){if(F.preset=="date"){return this.formatDate(F.dateFormat,new Date(D[C],D[y],D[h]),F)}else{if(F.preset=="datetime"){var E=(F.ampm)?((D[F.seconds?6:5]=="PM"&&(D[3]-0)<12)?(D[3]-0+12):(D[F.seconds?6:5]=="AM"&&(D[3]==12)?0:D[3])):D[3];return this.formatDate(F.dateFormat+" "+F.timeFormat,new Date(D[C],D[y],D[h],E,D[4],F.seconds?D[5]:null),F)}else{if(F.preset=="time"){var E=(F.ampm)?((D[F.seconds?3:2]=="PM"&&(D[0]-0)<12)?(D[0]-0+12):(D[F.seconds?3:2]=="AM"&&(D[0]==12)?0:D[0])):D[0];return this.formatDate(F.timeFormat,new Date(1970,0,1,E,D[1],F.seconds?D[2]:null),F)}}}}return F.formatResult(D)};this.validate=function(F){var G=this.settings;if(this.preset&&G.preset.match(/date/i)&&((F==C)||(F==y))){var E=32-new Date(this.temp[C],this.temp[y],32).getDate()-1;var D=a("ul:eq("+h+")",m);a("li",D).show();a("li:gt("+E+")",D).hide();if(this.temp[h]>E){if(G.fx){D.animate({top:(g*(j-E-1))+"px"},"fast")}else{D.css({top:(g*(j-E-1))})}this.temp[h]=a("li:eq("+E+")",D).data("val")}}else{k.validate(F)}};this.hide=function(){this.settings.onClose(this.val,this);a(":input:not(.dwtd)").attr("disabled","").removeClass("dwtd");m.hide();e.hide();A=false;if(this.preset){this.settings.wheels=null}a(window).unbind("resize.dw")};this.show=function(){var I=this.settings;I.beforeShow(x,this);g=I.height;j=Math.round(I.rows/2);i=this;this.init();if(this.preset){I.wheels=new Array();if(I.preset.match(/date/i)){var K={};for(var G=0;G<3;G++){if(G==C){K[I.yearText]={};for(var E=I.startYear;E<=I.endYear;E++){K[I.yearText][E]=E.toString().substr(2,2)}}else{if(G==y){K[I.monthText]={};for(var E=0;E<12;E++){K[I.monthText][E]=(E<9)?("0"+(E+1)):(E+1)}}else{if(G==h){K[I.dayText]={};for(var E=1;E<32;E++){K[I.dayText][E]=(E<10)?("0"+E):E}}}}}I.wheels.push(K)}if(I.preset.match(/time/i)){var K={};K[I.hourText]={};for(var E=1;E<(I.ampm?13:24);E++){K[I.hourText][E]=(E<10)?("0"+E):E}K[I.minuteText]={};for(var E=0;E<60;E++){K[I.minuteText][E]=(E<10)?("0"+E):E}if(I.seconds){K[I.secText]={};for(var E=0;E<60;E++){K[I.secText][E]=(E<10)?("0"+E):E}}if(I.ampm){K[I.ampmText]={};K[I.ampmText]["AM"]="AM";K[I.ampmText]["PM"]="PM"}I.wheels.push(K)}}a(".dwc",m).remove();for(var E=0;E<I.wheels.length;E++){var D=a('<div class="dwc"><div class="dwwc"><div class="clear" style="clear:both;"></div></div>').insertBefore(a(".dwbc",m));for(var H in I.wheels[E]){var J=a(".dwwc .clear",D);var K=a('<div class="dwwl"><div class="dwl">'+H+'</div><div class="dww"><ul></ul><div class="dwwo"></div></div><div class="dwwol"></div></div>').insertBefore(J);for(var F in I.wheels[E][H]){a('<li class="val_'+F+'">'+I.wheels[E][H][F]+"</li>").data("val",F).appendTo(a("ul",K))}}}a(".dww ul",m).each(function(L){var N=a("li",this).index(a("li.val_"+B.temp[L],this));var M=g*(j-(N<0?0:N)-1);a(this).css("top",M)});a(".dwv",m).html(this.formatResult());a("#dw_set",m).text(I.setText).unbind().click(function(){B.setValue();I.onSelect(B.val,i);B.hide();return false});a("#dw_cancel",m).text(I.cancelText).unbind().click(function(){B.hide();return false});a(":input:disabled").addClass("dwtd");a(":input").attr("disabled","disabled");e.show();m.attr("class","dw "+I.theme).show();A=true;a(".dww, .dwwl",m).height(I.rows*g);a(".dww",m).each(function(){a(this).width(a(this).parent().width()<I.width?I.width:a(this).parent().width())});a(".dwbc a",m).attr("class",I.btnClass);a(".dww li",m).css({height:g,lineHeight:g+"px"});a(".dwwc",m).each(function(){var L=0;a(".dwwl",this).each(function(){L+=a(this).outerWidth(true)});a(this).width(L)});a(".dwc",m).each(function(){a(this).width(a(".dwwc",this).outerWidth(true))});this.pos();a(window).bind("resize.dw",function(){setTimeout((function(){return B.pos})(),100)})};this.pos=function(){var H=0;var E=0;var K=a(window).width();var J=a(window).height();var F=a(window).scrollTop();var I;var D;a(".dwc",m).each(function(){I=a(this).outerWidth(true);H+=I;E=(I>E)?I:E});I=H>K?E:H;m.width(I);I=m.outerWidth();D=m.outerHeight();var G=F+(J-D)/2;m.css({left:(K-I)/2,top:G>0?G:32});e.height(0);e.height(a("div.ui-page-active:first").height())};this.init=function(){var D=this.settings;var G=D.dateOrder.search(/y/i);var F=D.dateOrder.search(/m/i);var E=D.dateOrder.search(/d/i);C=(G<F)?(G<E?0:1):(G<E?1:2);y=(F<G)?(F<E?0:1):(F<E?1:2);h=(E<G)?(E<F?0:1):(E<F?1:2);this.preset=(D.wheels===null);if(this.values!==null){this.temp=this.values.slice(0)}else{this.temp=this.parseValue(a(x).val()?a(x).val():"");this.setValue(false)}};this.init();a(x).is("input")?a(x).data("readonly",a(x).attr("readonly")).attr("readonly","readonly"):false;a(x).addClass("scroller").unbind("focus.dw").bind("focus.dw",function(){if(!B.settings.disabled&&B.settings.showOnFocus&&!A){B.show()}})}var d;var e;var g;var j;var i;var q={};var b=new Date();var w=b.getTime();var l=false;var u=null;var r;var t;var o;var v=("ontouchstart" in window);var s=v?"touchstart":"mousedown";var n=v?"touchmove":"mousemove";var f=v?"touchend":"mouseup";var c={width:60,height:40,rows:3,fx:false,disabled:false,showOnFocus:true,wheels:null,theme:"",preset:"date",dateFormat:"mm/dd/yy",dateOrder:"mdy",ampm:true,seconds:false,timeFormat:"hh:ii A",startYear:b.getFullYear()-10,endYear:b.getFullYear()+10,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",setText:"Set",cancelText:"Cancel",btnClass:"dwb",beforeShow:function(){},onClose:function(){},onSelect:function(){},formatResult:function(h){var x="";for(var m=0;m<h.length;m++){x+=(m>0?" ":"")+h[m]}return x},parseValue:function(h){return h.split(" ")}};var k={init:function(m){var x=a.extend({},c,m);if(a(".dwo").length){e=a(".dwo");d=a(".dw")}else{e=a('<div class="dwo"></div>').hide().appendTo("body");d=a('<div class="dw"><div class="dwv">&nbsp;</div><div class="dwbc" style="clear:both;"><a id="dw_set" href="#"></a><a id="dw_cancel" href="#"></a></div></div>');d.hide().appendTo("body");a(document).bind(n,function(y){if(l){t=v?y.originalEvent.changedTouches[0].pageY:y.pageY;u.css("top",(o+t-r)+"px");y.preventDefault();y.stopPropagation();return false}});function h(z,A){A=A>((j-1)*g)?((j-1)*g):A;A=A<(j*g-a("li:visible",z).length*g)?(j*g-a("li:visible",z).length*g):A;if(i.settings.fx){z.stop(true,true).animate({top:A+"px"},"fast")}else{z.css("top",A)}var y=a("ul",d).index(z);i.temp[y]=a("li:eq("+(j-1-A/g)+")",z).data("val");i.validate(y);a(".dwv",d).html(i.formatResult())}a(document).bind(f,function(y){if(l){var z=Math.round((o+t-r)/g)*g;z=z>((j-1)*g)?((j-1)*g):z;z=z<(j*g-a("li:visible",u).length*g)?(j*g-a("li:visible",u).length*g):z;h(u,z);l=false;u=null;y.preventDefault();y.stopPropagation()}});a(".dwwl").live("DOMMouseScroll mousewheel",function(z){var y=0;if(z.wheelDelta){y=z.wheelDelta/120}if(z.detail){y=-z.detail/3}var B=a("ul",this);var A=B.css("top").replace(/px/i,"")-0;var C=Math.round((A+y*g)/g)*g;h(B,C);z.preventDefault();z.stopPropagation()});a(".dwwl").live(s,function(y){if(!l){var z=v?y.originalEvent.changedTouches[0].pageX:y.pageX;var A=a(this).offset().left;l=true;u=a("ul",this);o=u.css("top").replace(/px/i,"")-0;r=v?y.originalEvent.changedTouches[0].pageY:y.pageY;t=r;y.preventDefault();y.stopPropagation()}})}return this.each(function(){if(!this.id){w+=1;this.id="scoller"+w}q[this.id]=new p(this,d,x)})},validate:function(){},enable:function(){return this.each(function(){if(q[this.id]){q[this.id].settings.disabled=false}})},disable:function(){return this.each(function(){if(q[this.id]){q[this.id].settings.disabled=true}})},isDisabled:function(){if(q[this[0].id]){return q[this[0].id].settings.disabled}},option:function(h,m){return this.each(function(){if(q[this.id]){if(typeof h==="object"){a.extend(q[this.id].settings,h)}else{q[this.id].settings[h]=m}q[this.id].init()}})},setValue:function(h,m){if(m==undefined){m=false}return this.each(function(){if(q[this.id]){q[this.id].temp=h;q[this.id].setValue(h,m)}})},getValue:function(){if(q[this[0].id]){return q[this[0].id].values}},setDate:function(h,m){if(m==undefined){m=false}return this.each(function(){if(q[this.id]){q[this.id].setDate(h,m)}})},getDate:function(){if(q[this[0].id]){return q[this[0].id].getDate()}},show:function(){if(q[this[0].id]){return q[this[0].id].show()}},hide:function(){return this.each(function(){if(q[this.id]){q[this.id].hide()}})},destroy:function(){return this.each(function(){if(q[this.id]){a(this).unbind("focus.dw").removeClass("scroller");a(this).is("input")?a(this).attr("readonly",a(this).data("readonly")):false;delete q[this.id]}})}};a.fn.scroller=function(h){if(k[h]){return k[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return k.init.apply(this,arguments)}else{a.error("Unknown method")}}};a.scroller=new p(null,null,c)})(jQuery);