/*
(c) Copyright Ascensio System SIA 2010-2014

This program is a free software product.
You can redistribute it and/or modify it under the terms 
of the GNU Affero General Public License (AGPL) version 3 as published by the Free Software
Foundation. In accordance with Section 7(a) of the GNU AGPL its Section 15 shall be amended
to the effect that Ascensio System SIA expressly excludes the warranty of non-infringement of 
any third-party rights.

This program is distributed WITHOUT ANY WARRANTY; without even the implied warranty 
of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For details, see 
the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html

You can contact Ascensio System SIA at Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021.

The  interactive user interfaces in modified source and object code versions of the Program must 
display Appropriate Legal Notices, as required under Section 5 of the GNU AGPL version 3.
 
Pursuant to Section 7(b) of the License you must retain the original Product logo when 
distributing the program. Pursuant to Section 7(e) we decline to grant you any rights under 
trademark law for use of our trademarks.
 
All the Product's GUI elements, including illustrations and icon sets, as well as technical writing
content are licensed under the terms of the Creative Commons Attribution-ShareAlike 4.0
International. See the License terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
*/

window.TeamlabMobile=(function(H){if(!H){console.log("Teamlab.default: has no TeamlabMobile");return DefaultMobile}var e={blogs:0,forums:0,events:0,bookmarks:0},I={modules:[{id:null,type:"community-page",title:ASC.Resources.BtnAll,link:"community",classname:"filter-item all",enabled:true},{id:"6a598c74-91ae-437d-a5f4-ad339bd11bb2",type:"community-page-blogs",title:ASC.Resources.BtnBlogs,link:"community/blogs",classname:"filter-item blogs",enabled:true},{id:"853b6eb9-73ee-438d-9b09-8ffeedf36234",type:"community-page-forums",title:ASC.Resources.BtnForums,link:"community/forums",classname:"filter-item forums",enabled:true},{id:"28b10049-dd20-4f54-b986-873bc14ccfc7",type:"community-page-bookmarks",title:ASC.Resources.BtnBookmarks,link:"community/bookmarks",classname:"filter-item bookmarks",enabled:true},{id:"3cfd481b-46f2-4a4a-b55c-b8c0c9def02c",type:"community-page-events",title:ASC.Resources.BtnEvents,link:"community/events",classname:"filter-item events",enabled:true}]},J={lbnewcommitems:"template-comm-timeline",pgcommunity:"template-page-community",pgcommblog:"template-page-community-blog",pgcommforum:"template-page-community-forum",pgcommevent:"template-page-community-event",pgcommbookmark:"template-page-community-bookmark",pgcommaddblog:"template-community-addblog",pgcommaddforum:"template-community-addforum",pgcommaddevent:"template-community-addevent",pgcommaddbookmark:"template-community-addbookmark"},G={blog:"community/blog/",forum:"community/forum/",event:"community/event/",bookmark:"community/bookmark/",blogs:"community/blogs",forums:"community/forums",events:"community/events",bookmarks:"community/bookmarks"},a={community:/^community[\/]*$/,cmt_blog:/^community\/blog\/([\w\d-]+)$/,cmt_forum:/^community\/forum\/([\w\d-]+)$/,cmt_event:/^community\/event\/([\w\d-]+)$/,cmt_bookmark:/^community\/bookmark\/([\w\d-]+)$/,cmt_blogs:/^community\/blogs[\/]*$/,cmt_forums:/^community\/forums[\/]*$/,cmt_events:/^community\/events[\/]*$/,cmt_bookmarks:/^community\/bookmarks[\/]*$/,cmt_addblog:/^community\/blogs\/add[\/]*$/,cmt_addforum:/^community\/forums\/add[\/]*$/,cmt_addevent:/^community\/events\/add[\/]*$/,cmt_addbookmark:/^community\/bookmarks\/add[\/]*$/,events:/^community\/event/,bookmarks:/^community\/bookmark/,blogs:/^community\/blog/,forums:/^community\/forum/},b={changePage:"onchangepage",addComment:"onaddcomment",loadComments:"onloadcomments",addCommunityComment:"onaddcommunitycomment",communityPage:"oncommunitypage",blogPage:"onblogpage",forumPage:"onforumpage",eventPage:"oneventpage",bookmarkPage:"onbookmarkpage",addBlogPage:"onaddblogpage",addForumPage:"onaddforumpage",addEventPage:"onaddeventpage",addBookmarkPage:"onaddbookmarkpage",blogsPage:"onblogspage",forumsPage:"onforumspage",eventsPage:"oneventspage",bookmarksPage:"onbookmarkspage",threadsPage:"onthreadspage",loadTimelineCommItems:"onloadtimelinecommitems",addBlog:"onaddblog",addForum:"onaddforum",addEvent:"onaddevent",addBookmark:"onaddbookmark",getThreads:"ongetthreads"},c=H.extendEventManager(b);H.extendModule(J,a,G);ASC.Controls.AnchorController.bind(a.forums,F);ASC.Controls.AnchorController.bind(a.events,F);ASC.Controls.AnchorController.bind(a.blogs,F);ASC.Controls.AnchorController.bind(a.bookmarks,F);ASC.Controls.AnchorController.bind(a.community,s);ASC.Controls.AnchorController.bind(a.cmt_blogs,p);ASC.Controls.AnchorController.bind(a.cmt_forums,w);ASC.Controls.AnchorController.bind(a.cmt_events,u);ASC.Controls.AnchorController.bind(a.cmt_bookmarks,r);ASC.Controls.AnchorController.bind(a.cmt_blog,o);ASC.Controls.AnchorController.bind(a.cmt_forum,v);ASC.Controls.AnchorController.bind(a.cmt_event,t);ASC.Controls.AnchorController.bind(a.cmt_bookmark,q);ASC.Controls.AnchorController.bind(a.cmt_addblog,g);ASC.Controls.AnchorController.bind(a.cmt_addforum,n);ASC.Controls.AnchorController.bind(a.cmt_addevent,l);ASC.Controls.AnchorController.bind(a.cmt_addbookmark,i);function d(M){var O={all:I.modules[0],blogs:I.modules[1],forums:I.modules[2],bookmarks:I.modules[3],events:I.modules[4]};for(var K in O){if(O.hasOwnProperty(K)){var L=O[K].id;var N=M.length;while(N--){if(M[N].webItemId==L){O[K].enabled=M[N].enabled===true}}}}return O}function s(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);H.getCommItems("all")}function p(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);H.getCommItems("blog")}function w(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);H.getCommItems("forum")}function u(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);H.getCommItems("event")}function r(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);H.getCommItems("bookmark")}function o(L,K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}if(K){c.call(b.changePage,window,[]);Teamlab.joint().getCmtBlog(null,K).getCmtBlogComments(null,K).start(null,x)}}function v(L,K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}if(K){c.call(b.changePage,window,[]);Teamlab.getCmtForumTopic(null,K,C)}}function t(L,K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}if(K){c.call(b.changePage,window,[]);Teamlab.joint().getCmtEvent(null,K).getCmtEventComments(null,K).start(null,B)}}function q(L,K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}if(K){L=L||{};c.call(b.changePage,window,[]);Teamlab.joint().getCmtBookmark(null,K).getCmtBookmarkComments(null,K).start(null,y)}}function g(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);c.call(b.addBlogPage,window,[])}function n(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);c.call(b.addForumPage,window,[])}function l(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);c.call(b.addEventPage,window,[])}function i(K){if(!H.validSession()){ASC.Controls.AnchorController.move(H.anchors.auth);return undefined}c.call(b.changePage,window,[]);c.call(b.addBookmarkPage,window,[])}function z(Y,Z,R,N){var U=[],P=[],X=d(Z);if(ASC.Controls.AnchorController.testAnchor(a.forums)&&X.forums.enabled===false){document.location.href="./"}U=U=X.forums.enabled===true&&R?U.concat(R):U;U.sort(H.dscSortByDate);var M=U.length<=H.constants.pageItems;if(U.length>H.constants.pageItems){U.splice(H.constants.pageItems,U.length)}var S=false;if(N.length>0){var O=N.length;while(O--){if(N[O].threads&&N[O].threads.length>0){S=true;break}}}var T=null,V=U.length;while(V--){T=U[V];T.classname=T.type;T.href="community/"+T.type+"/"+T.id}e.forums=U.length;if(ASC.Controls.AnchorController.testAnchor(a.cmt_forums)){var K=[].concat(I.modules);for(var Q in X){if(X.hasOwnProperty(Q)){var W=X[Q].id;var L=K.length;while(L--){if(K[L].id==W){if(X[Q].enabled!==true){K.splice(L,1)}break}}}}c.call(b.forumsPage,window,[U,K,M,S])}}function A(aa,ac,N,T,R,O){var W=[],Q=[],ab,Z=d(ac);if(ASC.Controls.AnchorController.testAnchor(a.events)&&Z.events.enabled===false){ab=true}if(ASC.Controls.AnchorController.testAnchor(a.forums)&&Z.forums.enabled===false){ab=true}if(ASC.Controls.AnchorController.testAnchor(a.bookmarks)&&Z.bookmarks.enabled===false){ab=true}if(ASC.Controls.AnchorController.testAnchor(a.blogs)&&Z.blogs.enabled===false){ab=true}if(ab){document.location.href="./"}W=Z.blogs.enabled===true&&N?W.concat(N):W;W=Z.forums.enabled===true&&T?W.concat(T):W;W=Z.events.enabled===true&&R?W.concat(R):W;W=Z.bookmarks.enabled===true&&O?W.concat(O):W;W.sort(H.dscSortByDate);var M=W.length<=H.constants.pageItems;if(W.length>H.constants.pageItems){W.splice(H.constants.pageItems,W.length)}e.blogs=0;e.forums=0;e.events=0;e.bookmarks=0;aa=(aa&&aa.length?aa[aa.length-1]:{});var P=aa.hasOwnProperty("customEvent")?aa.customEvent:null,ad=aa.hasOwnProperty("type")?aa.type:null,V=null,X=W.length;while(X--){V=W[X];V.classname=V.type;V.href="community/"+V.type+"/"+V.id;switch(V.type){case"blog":e.blogs+=1;break;case"forum":e.forums+=1;break;case"event":e.events+=1;break;case"bookmark":e.bookmarks+=1;break}}var U=false;switch(P){case b.communityPage:U=ASC.Controls.AnchorController.testAnchor(a.community);break;case b.blogsPage:U=ASC.Controls.AnchorController.testAnchor(a.cmt_blogs);break;case b.forumsPage:U=ASC.Controls.AnchorController.testAnchor(a.cmt_forums);break;case b.eventsPage:U=ASC.Controls.AnchorController.testAnchor(a.cmt_events);break;case b.bookmarksPage:U=ASC.Controls.AnchorController.testAnchor(a.cmt_bookmarks);break}if(U){var K=[].concat(I.modules);for(var S in Z){if(Z.hasOwnProperty(S)){var Y=Z[S].id;var L=K.length;while(L--){if(K[L].id==Y){if(Z[S].enabled!==true){K.splice(L,1)}break}}}}c.call(P,window,[W,K,M])}}function E(T,U,L,O,N,M){var Q=[],S=d(U);Q=S.blogs.enabled===true&&L?Q.concat(L):Q;Q=S.forums.enabled===true&&O?Q.concat(O):Q;Q=S.events.enabled===true&&N?Q.concat(N):Q;Q=S.bookmarks.enabled===true&&M?Q.concat(M):Q;Q.sort(H.dscSortByDate);var K=Q.length<=H.constants.pageItems;if(Q.length>H.constants.pageItems){Q.splice(H.constants.pageItems,Q.length)}T=(T&&T.length?T[T.length-1]:{});var V=T.hasOwnProperty("type")?T.type:null,P=null,R=Q.length;while(R--){P=Q[R];P.classname=P.type;P.href="community/"+P.type+"/"+P.id;switch(P.type){case"blog":e.blogs+=1;break;case"forum":e.forums+=1;break;case"event":e.events+=1;break;case"bookmark":e.bookmarks+=1;break}}c.call(b.loadTimelineCommItems,window,[V,Q,K])}function D(P,M){var Q=[];for(var K=0,O=M.length;K<O;K++){Q=Q.concat(M[K].threads)}M=Q;var L=null,N=M.length;while(N--){L=M[N];L.classname=L.type;L.href="community/"+L.type+"/"+L.id}c.call(b.getThreads,window,[M])}function f(L,K){K.classname=K.type;if(ASC.Controls.AnchorController.testAnchor(a.cmt_addblog)){ASC.Controls.AnchorController.lazymove({back:H.anchors.blogs},H.anchors.blog+K.id)}}function x(M,L,K){L.classname=L.type;L.comments=K;if(ASC.Controls.AnchorController.testAnchor(a.cmt_blog)){M.back=H.regexps.community.test(ASC.Controls.AnchorController.getAnchor())?ASC.Controls.AnchorController.getAnchor():null;c.call(b.blogPage,window,[L,M])}}function m(L,K){K.classname=K.type;if(ASC.Controls.AnchorController.testAnchor(a.cmt_addforum)){ASC.Controls.AnchorController.lazymove({back:H.anchors.forums},H.anchors.forum+K.id)}}function C(L,K){K.classname=K.type;if(ASC.Controls.AnchorController.testAnchor(a.cmt_forum)){L.back=H.regexps.community.test(ASC.Controls.AnchorController.getAnchor())?ASC.Controls.AnchorController.getAnchor():null;c.call(b.forumPage,window,[K,L])}}function k(L,K){K.classname=K.type;if(ASC.Controls.AnchorController.testAnchor(a.cmt_addevent)){ASC.Controls.AnchorController.lazymove({back:H.anchors.events},H.anchors.event+K.id)}}function B(M,L,K){L.classname=L.type;L.comments=K;if(ASC.Controls.AnchorController.testAnchor(a.cmt_event)){M.back=H.regexps.community.test(ASC.Controls.AnchorController.getAnchor())?ASC.Controls.AnchorController.getAnchor():null;c.call(b.eventPage,window,[L,M])}}function h(L,K){K.classname=K.type;if(ASC.Controls.AnchorController.testAnchor(a.cmt_addbookmark)){ASC.Controls.AnchorController.lazymove({back:H.anchors.bookmarks},H.anchors.bookmark+K.id)}}function y(M,L,K){L.classname=L.type;L.comments=K;if(ASC.Controls.AnchorController.testAnchor(a.cmt_bookmark)){M.back=H.regexps.community.test(ASC.Controls.AnchorController.getAnchor())?ASC.Controls.AnchorController.getAnchor():null;c.call(b.bookmarkPage,window,[L,M])}}function j(L,K){c.call(b.addCommunityComment,window,[K,L]);c.call(b.addComment,window,[K,L])}H.getThreads=function(){Teamlab.getCmtForumCategories(null,D)};H.hasMoreCommItems=function(K){return true};H.getCommItems=function(K){switch(K){case"all":Teamlab.joint().getWebItemSecurityInfo(null,null).getCmtBlogs(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).getCmtForumTopics(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).getCmtEvents(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).getCmtBookmarks(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).start({type:K,customEvent:b.communityPage},A);break;case"blog":Teamlab.joint().getWebItemSecurityInfo(null,null).getCmtBlogs(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).start({type:K,customEvent:b.blogsPage},A);break;case"forum":Teamlab.joint().getWebItemSecurityInfo(null,null).getCmtForumTopics(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).getCmtForumCategories(null).start({type:K,customEvent:b.forumsPage},z);break;case"event":Teamlab.joint().getWebItemSecurityInfo(null,null).getCmtEvents(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).start({type:K,customEvent:b.eventsPage},A);break;case"bookmark":Teamlab.joint().getWebItemSecurityInfo(null,null).getCmtBookmarks(null,{filter:{startIndex:0,count:H.constants.pageItems+1}}).start({type:K,customEvent:b.bookmarksPage},A);break}};H.getMoreCommItems=function(N){var M=-1,K=null,L=null;switch(N){case"all":Teamlab.joint().getWebItemSecurityInfo(null,null).getCmtBlogs(null,{filter:{startIndex:e.blogs,count:H.constants.pageItems+1}}).getCmtForumTopics(null,{filter:{startIndex:e.forums,count:H.constants.pageItems+1}}).getCmtEvents(null,{filter:{startIndex:e.events,count:H.constants.pageItems+1}}).getCmtBookmarks(null,{filter:{startIndex:e.bookmarks,count:H.constants.pageItems+1}}).start({type:N,customEvent:b.loadTimelineCommItems},E);break;case"blog":L=Teamlab.getCmtBlogs;M=e.blogs;K=b.loadTimelineCommItems;break;case"forum":L=Teamlab.getCmtForumTopics;M=e.forums;K=b.loadTimelineCommItems;break;case"event":L=Teamlab.getCmtEvents;M=e.events;K=b.loadTimelineCommItems;break;case"bookmark":L=Teamlab.getCmtBlogs;M=e.bookmarks;K=b.loadTimelineCommItems;break}if(M!==-1&&L&&K){Teamlab.joint();Teamlab.getWebItemSecurityInfo(null,null);L(null,{filter:{startIndex:M,count:H.constants.pageItems+1}});Teamlab.start({type:N,customEvent:K},E)}};H.addCommunityComment=function(O,N,L){var M=null,K=null;switch(O){case"blog":M=Teamlab.addCmtBlogComment;K=j;break;case"forum":M=Teamlab.addCmtForumTopicPost;K=j;break;case"event":M=Teamlab.addCmtEventComment;K=j;break;case"bookmark":M=Teamlab.addCmtBookmarkComment;K=j;break}if(M&&K){return M({type:O},N,L,K)}return false};H.addCommunityItem=function(N,L){var M=null,K=null;switch(N){case"blog":M=Teamlab.addCmtBlog;K=f;break;case"forum":M=Teamlab.addCmtForumTopic;K=m;break;case"event":M=Teamlab.addCmtEvent;K=k;break;case"bookmark":M=Teamlab.addCmtBookmark;K=h;break}if(M&&K){return M(null,L,K)}return false};function F(N){var K=I.modules,M=K.length,L=[],O;while(M--){if(K[M].id!==null){L.unshift(K[M].id);continue}}Teamlab.getWebItemSecurityInfo({},L,{success:function(T,R){for(var P=0;P<K.length;P++){for(var Q=0;Q<R.length;Q++){if(K[P].id==R[Q].webItemId&&R[Q].enabled===false){var S=K[P].link;switch(S){case"community/blogs":if(ASC.Controls.AnchorController.testAnchor(a.blogs)){O=true}break;case"community/forums":if(ASC.Controls.AnchorController.testAnchor(a.forums)){O=true}break;case"community/bookmarks":if(ASC.Controls.AnchorController.testAnchor(a.bookmarks)){O=true}break;case"community/events":if(ASC.Controls.AnchorController.testAnchor(a.events)){O=true}break}if(O){document.location.href="./"}}}}}})}return H})(TeamlabMobile);