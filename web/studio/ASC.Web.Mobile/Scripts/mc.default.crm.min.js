/*
(c) Copyright Ascensio System SIA 2010-2014

This program is a free software product.
You can redistribute it and/or modify it under the terms 
of the GNU Affero General Public License (AGPL) version 3 as published by the Free Software
Foundation. In accordance with Section 7(a) of the GNU AGPL its Section 15 shall be amended
to the effect that Ascensio System SIA expressly excludes the warranty of non-infringement of 
any third-party rights.

This program is distributed WITHOUT ANY WARRANTY; without even the implied warranty 
of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For details, see 
the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html

You can contact Ascensio System SIA at Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021.

The  interactive user interfaces in modified source and object code versions of the Program must 
display Appropriate Legal Notices, as required under Section 5 of the GNU AGPL version 3.
 
Pursuant to Section 7(b) of the License you must retain the original Product logo when 
distributing the program. Pursuant to Section 7(e) we decline to grant you any rights under 
trademark law for use of our trademarks.
 
All the Product's GUI elements, including illustrations and icon sets, as well as technical writing
content are licensed under the terms of the Creative Commons Attribution-ShareAlike 4.0
International. See the License terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
*/

window.DefaultMobile=(function(a){if(!a){console.log("Default.crm: has no DefaultMobile");return a}var c="",d="";function b(e){var f={contactid:e.find("input.note-contactid:first").removeClass("error-field").val(),title:e.find("input.note-title:first").removeClass("error-field").val()||"",content:e.find("textarea.note-description:first").removeClass("error-field").val()||""};for(var h in f){if(f.hasOwnProperty(h)){f[h]=TeamlabMobile.verificationValue(f[h])}}var g=[];for(var h in f){if(f.hasOwnProperty(h)){if(f[h]!==null){continue}switch(h){case"contactid":g.push(e.find("input.note-contactid:first").addClass("error-field"));break;case"content":g.push(e.find("textarea.note-description:first").addClass("error-field"));break;case"title":g.push(e.find("input.note-title:first").addClass("error-field"));break}}}if(g.length===0){return f}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}a.reset_search_crm_contacts=function(g,e,f){d="";TeamlabMobile.getCrmContactsBySearchValue(null)};a.search_crm_contacts=function(f){var e=$(f.target),g="";g=e.length>0?e.find("input.top-search-field:first").val():g;if(typeof g!=="string"||(g=(g.replace(/^\s+|\s+$/g,"")).toLowerCase())===d){return undefined}d=g;TeamlabMobile.getCrmContactsBySearchValue(g)};a.filter_crm_contacts=function(g){var f=null,i=null,e=null,j=0,k="",h=g.target.value;if(typeof h!=="string"||(h=(h.replace(/^\s+|\s+$/g,"")).toLowerCase())===c){return undefined}c=h;f=$("div.ui-page-active:first");if(h){f.find("form.search-form:first").addClass("active")}else{f.find("form.search-form:first").removeClass("active")}e=f.find("li.item.person");j=e.length;while(j--){i=e[j];k=i.getAttribute("data-itemname");if(!k){continue}if(k.toLowerCase().indexOf(h)===-1){$(i).addClass("uncorrect-item")}else{hasCorrect=true;$(i).removeClass("uncorrect-item")}}};a.search_crm_tasks=function(f){var e=$(f.target),g="";g=e.length>0?e.find("input.top-search-field:first").val():g;if(g){TeamlabMobile.getCrmTasksBySearchValue(g)}else{return}};a.load_more_crm_items=function(g,f,e){var h=null;var i={};if(e.attr("data-id")){i.id=e.attr("data-id")}if(e.attr("page")){i.page=e.attr("page")}if(f.hasClass("page-crm")){h=TeamlabMobile.getMoreCrmItems}if(f.hasClass("page-crm-tasks")){h=TeamlabMobile.getMoreCrmTasks}if(f.hasClass("page-crm-contacttasks")){h=TeamlabMobile.getMoreCrmContactTasks}if(f.hasClass("page-crm-history")){h=TeamlabMobile.getMoreCrmHistoryEvents}if(f.hasClass("page-crm-contactpersones")){h=TeamlabMobile.getMoreCrmContactPersones}if(f.hasClass("page-crm-contactfiles")){h=TeamlabMobile.getMoreCrmContactFiles}if(h){f.addClass("loading-items");if(i.id!=null){h(null,i.id)}if(i.page!=null){h(null,i.page)}if(i.id==null&&i.page==null){h(null)}}};a.add_crm_task=function(i,f,e){if(f.length===0){return undefined}e.removeClass("add-crm-task");var g={title:null,deadline:null,responsibleid:null,categoryid:-1,isnotify:true};var h=[];if($("div.ui-page-active").find("input.task-title").val().length<=0){h.push($("div.ui-page-active").find("input.task-title").addClass("error-field"))}else{g.title=$("div.ui-page-active").find("input.task-title:first").removeClass("error-field").val()}if($("div.ui-page-active").find("select.task-type").attr("value")==-1){h.push($("div.ui-page-active").find("select.task-type").parent().addClass("error-field"))}else{$("div.ui-page-active").find("select.task-type").parent().removeClass("error-field").attr("value");g.categoryid=$("div.ui-page-active").find("select.task-type  option:selected").val()}if($("div.ui-page-active").find("textarea.task-description").val().length>0){g.description=$("div.ui-page-active").find("textarea.task-description").removeClass("error-field").val()}if($("div.ui-page-active").find("input.task-duedate").val()==""||$("div.ui-page-active").find("input.task-duedate").val()==null){h.push($("div.ui-page-active").find("input.task-duedate").addClass("error-field"))}else{g.deadline=new Date($("div.ui-page-active").find("input.task-duedate:first").removeClass("error-field").scroller("getDate"));g.deadline.setMinutes(0);g.deadline.setHours(0)}if($("div.ui-page-active").find("select.group-responsible  option:selected").val()==-1||$("div.ui-page-active").find("select.group-responsible  option:selected").val()==null){h.push($("div.ui-page-active").find("select.group-responsible").parent().addClass("error-field"))}else{$("div.ui-page-active").find("select.group-responsible").parent().removeClass("error-field")}if($("div.ui-page-active").find("select.task-responsible  option:selected").val()==-1||$("div.ui-page-active").find("select.task-responsible  option:selected").val()==null){h.push($("div.ui-page-active").find("select.task-responsible").addClass("error-field"))}else{g.responsibleid=$("div.ui-page-active").find("select.task-responsible  option:selected").removeClass("error-field").val()}if(e.attr("data-id")!=""||e.attr("data-id")!=null||e.attr("data-id")!=undefined){g.contactId=e.attr("data-id")}if(h.length==0){return Teamlab.addCrmTask(null,g,{success:function(k,j){if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.crmaddtask)){j=TeamlabMobile.preparationCrmTask(j);if(e.attr("data-id")!=null){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+g.contactId+"/tasks"},"#crm/contact/"+g.contactId+"/tasks")}else{ASC.Controls.AnchorController.lazymove({back:"#crm/tasks/"+j.timeType},"#crm/tasks/"+j.timeType)}}}})}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);e.addClass("add-crm-task");return false};a.add_crm_company=function(r,f,e){if(f.length===0){return undefined}var m={companyName:null};var k=[];m.addresses=[];var q=[];if($("div.ui-page-active").find("input.persone-firstname").val().length<=0){q.push($("div.ui-page-active").find("input.persone-firstname").addClass("error-field"))}else{m.companyName=$("div.ui-page-active").find("input.persone-firstname").removeClass("error-field").val()}var u=$('div.ui-page-active div.fields-container[data = "phone"]').find("div.info");for(var s=0;s<u.length;s++){$(u[s]).find("input.contact-phone").removeClass("error-field");var v=$(u[s]).find("input.contact-phone").val();if($(u[s]).find("input.contact-phone").val().length>0){if(v.search(/[0-9 -()]+/)==-1){q.push($(u[s]).find("input.contact-phone").addClass("error-field"))}else{var t={};t.InfoType=0;t.Category=$(u[s]).find('select.phone-type option:selected"').val();t.Data=$(u[s]).find("input.contact-phone").val();if(s==0){t.IsPrimary=true}else{t.IsPrimary=false}k.push(t)}}}var o=$('div.ui-page-active div.fields-container[data = "email"]').find("div.info");for(var s=0;s<o.length;s++){$(o[s]).find("input.contact-email").removeClass("error-field");var p=$(o[s]).find("input.contact-email").val();if(p.length>0){if(p.search(/[\w]+[@][\w]+[.][a-zA-Z]+/)==-1){q.push($(o[s]).find("input.contact-email").addClass("error-field"))}else{var n={};n.InfoType=1;n.Category=$(o[s]).find('select.email-type option:selected"').val();n.Data=$(o[s]).find("input.contact-email").val();if(s==0){n.IsPrimary=true}else{n.IsPrimary=false}k.push(n)}}}var h=$("div.ui-page-active").find('div.fields-container[data = "address"]').find("div.info");for(var s=0;s<h.length;s++){if($(h[s]).find("input.detail").val().length>0||$(h[s]).find("input.city").val().length>0||$(h[s]).find("input.state").val().length>0||$(h[s]).find("input.zipcode").val().length>0){var g={};g.InfoType=7;g.Category=$(h[s]).find('select.address-type option:selected"').val();var l=$(h[s]).find("input.detail").val();var j=$(h[s]).find("input.city").val();var z=$(h[s]).find("input.street").val();var y=$(h[s]).find("input.state").val();var A=$(h[s]).find("input.zipcode").val();g.data='{\r\n  "street": "'+z+'",\r\n  "city": "'+j+'",\r\n  "state": "'+y+'",\r\n  "zip": "'+A+'",\r\n  "country": "'+l+'"\r\n}';if(s==0){g.IsPrimary=true}else{g.IsPrimary=false}k.push(g)}}var x=$("div.ui-page-active").find("input.contact-site");for(var s=0;s<x.length;s++){if($(x[s]).val().length>0){var w={};w.InfoType=2;w.Data=$(x[s]).val();if(s==0){w.IsPrimary=true}else{w.IsPrimary=false}k.push(w)}}if(q.length==0){e.removeClass("add-crm-company");if(e.hasClass("edit")){return Teamlab.updateCrmCompany(null,e.attr("data-id"),m,{success:function(C,i){var B={items:k};Teamlab.updateCrmContactData(null,i.id,B);if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.editcompany)){TeamlabMobile.onGetContact_(C,i);ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+i.id},"#crm/contact/"+i.id)}}})}else{return Teamlab.addCrmCompany(null,m,{success:function(C,i){var B={items:k};if(B.items.length>0){Teamlab.addCrmContactData(null,i.id,B)}if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.addcompany)){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+i.id},"#crm/contact/"+i.id)}}})}}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return false};a.add_crm_persone=function(r,f,e){if(f.length==0){return undefined}var m={firstName:null,lastName:null};var k=[];m.addresses=[];var q=[];if($("div.ui-page-active").find("input.persone-firstname").val().length<=0){q.push($("div.ui-page-active").find("input.persone-firstname").addClass("error-field"))}else{m.firstName=$("div.ui-page-active").find("input.persone-firstname").removeClass("error-field").val()}if($("div.ui-page-active").find("input.persone-secondname:first").val().length<=0){q.push($("div.ui-page-active").find("input.persone-secondname:first").addClass("error-field"))}else{m.lastName=$("div.ui-page-active").find("input.persone-secondname").removeClass("error-field").val()}if((e.attr("data-contactid")!=null&&e.hasClass("edit"))||(e.attr("data-id")!=null&&!e.hasClass("edit"))){m.companyId=e.attr("data-contactid")!=null?e.attr("data-contactid"):e.attr("data-id")}if($("div.ui-page-active").find("input.persone-position").val().length>0){m.jobTitle=$("div.ui-page-active").find("input.persone-position").removeClass("error-field").val()}var u=$('div.ui-page-active div.fields-container[data = "phone"]').find("div.info");for(var s=0;s<u.length;s++){$(u[s]).find("input.contact-phone").removeClass("error-field");var v=$(u[s]).find("input.contact-phone").val();if($(u[s]).find("input.contact-phone").val().length>0){if(v.search(/[0-9 -()]+/)==-1){q.push($(u[s]).find("input.contact-phone").addClass("error-field"))}else{var t={};t.InfoType=0;t.Category=$(u[s]).find('select.phone-type option:selected"').val();t.Data=$(u[s]).find("input.contact-phone").val();if(s==0){t.IsPrimary=true}else{t.IsPrimary=false}k.push(t)}}}var o=$('div.ui-page-active div.fields-container[data = "email"]').find("div.info");for(var s=0;s<o.length;s++){$(o[s]).find("input.contact-email").removeClass("error-field");var p=$(o[s]).find("input.contact-email").val();if(p.length>0){if(p.search(/[\w]+[@][\w]+[.][a-zA-Z]+/)==-1){q.push($(o[s]).find("input.contact-email").addClass("error-field"))}else{var n={};n.InfoType=1;n.Category=$(o[s]).find('select.email-type option:selected"').val();n.Data=$(o[s]).find("input.contact-email").val();if(s==0){n.IsPrimary=true}else{n.IsPrimary=false}k.push(n)}}}var h=$("div.ui-page-active").find('div.fields-container[data = "address"]').find("div.info");for(var s=0;s<h.length-1;s++){if($(h[s]).find("input.detail").val().length>0||$(h[s]).find("input.city").val().length>0||$(h[s]).find("input.state").val().length>0||$(h[s]).find("input.zipcode").val().length>0){var g={};g.InfoType=7;g.Category=g.Category=$(h[s]).find('select.address-type option:selected"').val();var l=$(h[s]).find("input.detail").val();var j=$(h[s]).find("input.city").val();var z=$(h[s]).find("input.street").val();var y=$(h[s]).find("input.state").val();var A=$(h[s]).find("input.zipcode").val();g.data='{\r\n  "street": "'+z+'",\r\n  "city": "'+j+'",\r\n  "state": "'+y+'",\r\n  "zip": "'+A+'",\r\n  "country": "'+l+'"\r\n}';if(s==0){g.IsPrimary=true}else{g.IsPrimary=false}k.push(g)}}var x=$("div.ui-page-active").find("input.contact-site");for(var s=0;s<x.length;s++){if($(x[s]).val().length>0){var w={};w.InfoType=2;w.Data=$(x[s]).val();if(s==0){w.IsPrimary=true}else{w.IsPrimary=false}k.push(w)}}if(q.length==0){e.removeClass("add-crm-persone");if(e.hasClass("edit")){return Teamlab.updateCrmPerson({},e.attr("data-id"),m,{success:function(C,i){if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.editperson)){var B={items:k};Teamlab.updateCrmContactData(null,i.id,B);TeamlabMobile.onGetContact_(C,i);ASC.Controls.AnchorController.move({back:"#crm/contact/"+i.id},"#crm/contact/"+i.id)}}})}else{return Teamlab.addCrmPerson(null,m,{success:function(C,i){var B={items:k};if(B.items.length>0){Teamlab.addCrmContactData(null,i.id,B)}if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.addpersone)){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+i.id},"#crm/contact/"+i.id)}}})}}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return false};a.add_crm_history_event=function(i,f,e){if(f.length===0){return undefined}var g={contactId:$("div.ui-page-active").find("button.add-crm-history-event").attr("data-id")};var h=[];if($("div.ui-page-active").find("select.historyevent-type").attr("value")==-1){h.push($("div.ui-page-active").find("select.historyevent-type").parent().addClass("error-field"))}else{$("div.ui-page-active").find("select.historyevent-type").parent().removeClass("error-field");g.categoryId=$("div.ui-page-active").find("select.historyevent-type").attr("value")}if($("div.ui-page-active").find("textarea.historyevent-description").val()==""||$("div.ui-page-active").find("textarea.historyevent-description").val()==null){h.push($("div.ui-page-active").find("textarea.historyevent-description").addClass("error-field"))}else{g.content=$("div.ui-page-active").find("textarea.historyevent-description").removeClass("error-field").val()}if($("div.ui-page-active").find("input.historyevent-date").val()==""||$("div.ui-page-active").find("input.historyevent-date").val()==null){h.push($("div.ui-page-active").find("input.historyevent-date").addClass("error-field"))}else{g.created=new Date($("input.historyevent-date:first").removeClass("error-field").scroller("getDate"));var j=new Date();g.created.setHours(j.getHours(),j.getMinutes(),j.getSeconds())}if(h.length==0){return Teamlab.addCrmHistoryEvent(null,g,{success:function(){if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.addhistoryevent)){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+g.contactId+"/history"},"#crm/contact/"+g.contactId+"/history")}}})}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return false};a.cansel_crm_task=function(g,f,e){if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.crmaddtask)){if(f.attr("data-itemid")!=undefined&&f.attr("data-itemid")!=""&&f.attr("data-itemid")!=null){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+f.attr("data-itemid")+"/tasks"},"#crm/contact/"+f.attr("data-itemid")+"/tasks")}else{ASC.Controls.AnchorController.lazymove({back:"#crm/tasks/today"},"#crm/tasks/today")}}};a.cansel_crm_person=function(g,f,e){if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.crmaddtask)){if(f.attr("data-itemid")!=undefined&&f.attr("data-itemid")!=""&&f.attr("data-itemid")!=null){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+f.attr("data-itemid")},"#crm/contact/"+f.attr("data-itemid"))}else{ASC.Controls.AnchorController.lazymove({back:"#crm/tasks/today"},"#crm/tasks/today")}}};a.delete_crm_history_event=function(g,f,e){if(confirm("Delete this event?")){Teamlab.removeCrmHistoryEvent(null,e.attr("data-id"),{success:function(){if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.contacthistory)){e.parent().parent().remove()}}})}else{}};a.add=function(h,g,e){var f=e.parent().parent();var i=[];i=f.find("div");if(i.length<5){f.find("div:first").clone().prependTo(e.parent().parent())}else{e.parent().hide}};a.delete_field=function(h,g,e){var f=e.parent();f.remove()};a.group_responsible=function(g,f,e){Teamlab.getProfiles(null,{success:function(l,k){$(".task-responsible").parent().remove();$(".assign").remove();if(f.find('select.group-responsible option:selected"').val()!=-1){$(".group-responsible").parent().after('<label class = "assign">Assign to:</label><select class="task-responsible" type="text"></select>');var h=$(".group-responsible option:selected").val();if(h==0){for(var j=0;j<k.length;j++){if(k[j].group==null){$(".task-responsible").append('<option value="'+k[j].id+'">'+k[j].displayName+"</option>")}}}else{for(var j=0;j<k.length;j++){if(k[j].group!=null&&k[j].group.id==h){$(".task-responsible").append('<option value="'+k[j].id+'">'+k[j].displayName+"</option>")}}}jQuery(document).trigger("updatepage")}}})};a.task_delete=function(g,f,e){if(confirm("Delete this task?")){Teamlab.removeCrmTask(null,f.attr("data-itemid"));if(ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.crmtask)||ASC.Controls.AnchorController.testAnchor(TeamlabMobile.regexps.contacttask)){if(f.attr("data-contactid")!=null||f.attr("data-contactid")!=undefined){ASC.Controls.AnchorController.lazymove({back:"#crm/contact/"+f.attr("data-contactid")+"/tasks"},"#crm/contact/"+f.attr("data-contactid")+"/tasks")}else{ASC.Controls.AnchorController.lazymove({back:"#crm/tasks/today"},"#crm/tasks/today")}}}else{}};a.edit_contact=function(g,f,e){TeamlabMobile.editCrmContact(e.attr("data-id"))};a.crm_add_note_to_contact=function(h,f,e){var g=b(f);if(g&&TeamlabMobile.addCrmNoteToContact(g.contactid,g)){jQuery(document).trigger("changepage");e.addClass("disabled")}};return a})(DefaultMobile);(function(a){TeamlabMobile.bind(TeamlabMobile.events.crmPage,q);TeamlabMobile.bind(TeamlabMobile.events.crmTasksPage,s);TeamlabMobile.bind(TeamlabMobile.events.addMoreCrmItemsToList,d);TeamlabMobile.bind(TeamlabMobile.events.crmTaskPage,r);TeamlabMobile.bind(TeamlabMobile.events.crmAddTaskPage,l);TeamlabMobile.bind(TeamlabMobile.events.crmAddCompanyPage,h);TeamlabMobile.bind(TeamlabMobile.events.crmAddPersonePage,k);TeamlabMobile.bind(TeamlabMobile.events.crmAddHistoryEventPage,i);TeamlabMobile.bind(TeamlabMobile.events.crmAddNotePage,j);TeamlabMobile.bind(TeamlabMobile.events.crmContactHistoryPage,n);TeamlabMobile.bind(TeamlabMobile.events.crmContactTasksPage,p);TeamlabMobile.bind(TeamlabMobile.events.crmContactPersonesPage,o);TeamlabMobile.bind(TeamlabMobile.events.crmContactFilesPage,m);TeamlabMobile.bind(TeamlabMobile.events.companyPage,g);TeamlabMobile.bind(TeamlabMobile.events.personPage,u);TeamlabMobile.bind(TeamlabMobile.events.updateCrmTaskCheckbox,w);TeamlabMobile.bind(TeamlabMobile.events.addCrmItemDialog,b);TeamlabMobile.bind(TeamlabMobile.events.navigateCrmDialog,t);TeamlabMobile.bind(TeamlabMobile.events.addToContactCrmDialog,e);TeamlabMobile.bind(TeamlabMobile.events.addFileToContactCrmDialog,c);function d(x,y){x={items:x};a(".ui-page-active").find(".loading-indicator").hide();if(!y.nextIndex){a("div.ui-page-active").find("span.load-more-items").hide()}a(".ui-page-active").find("ul.ui-timeline:first").append(DefaultMobile.processTemplate(y.tmpl,x));jQuery(document).trigger("updatepage")}function q(y,z){y={pagetitle:ASC.Resources.LblCrmTitle,type:"crm-page",items:y,nextIndex:z.nextIndex,filtervalue:z.filtervalue||null};var x=DefaultMobile.renderPage("crm-page","page-crm","crm",ASC.Resources.LblCrmTitle,y).addClass("filter-none")}function s(y,z){y={pagetitle:ASC.Resources.LblCrmTitle,type:"crm-tasks-page",items:y,nextIndex:z.nextIndex,page:z.page};var x=DefaultMobile.renderPage("crm-tasks-page","page-crm-tasks","crm-tasks",ASC.Resources.LblCrmTitle,y).addClass("filter-none")}function p(y,z,A){z={pagetitle:ASC.Resources.LblCrmTitle,type:"page-crm-contactasks",items:z,contact:y,id:A.id,nextIndex:A.nextIndex};var x=DefaultMobile.renderPage("crm-contacttasks-page","page-crm-contactasks","crm-contacttasks",ASC.Resources.LblCrmTitle,z).addClass("filter-none")}function o(y,z,A){z={pagetitle:ASC.Resources.LblCrmTitle,type:"page-crm-contacpersones",items:z,contact:y,id:A.id,nextIndex:A.nextIndex};var x=DefaultMobile.renderPage("crm-contactpersones-page","page-crm-contacpersones","crm-contactpersones",ASC.Resources.LblCrmTitle,z).addClass("filter-none")}function m(y,z,A){z={pagetitle:ASC.Resources.CrmDocsPage,type:"page-crm-contactfiles",items:z,contact:y,id:A.id,nextIndex:A.nextIndex};var x=DefaultMobile.renderPage("page-crm-contactfiles","page-crm-contactfiles","crm-contactfiles",ASC.Resources.LblCrmTitle,z).addClass("filter-none")}function n(y,z,A){z={pagetitle:ASC.Resources.CrmHistoryPage,type:"page-crm-contacthistory",items:z,contact:y,id:A.id,nextIndex:A.nextIndex};var x=DefaultMobile.renderPage("page-crm-contacthistory","page-crm-contacthistory","crm-contacthistory",ASC.Resources.LblCrmTitle,z).addClass("filter-none")}function v(y,z,A){z={pagetitle:ASC.Resources.LblCrmTitle,type:"crm-page-persons",items:z};var x=DefaultMobile.renderPage("crm-persons-page","page-crm-persons","crm-persons",ASC.Resources.LblCrmTitle,z).addClass("filter-persons")}function f(y,z){y={pagetitle:ASC.Resources.LblCrmTitle,type:"crm-page-companies",items:y};var x=DefaultMobile.renderPage("crm-companies-page","page-crm-companies","crm-companies",ASC.Resources.LblCrmTitle,y).addClass("filter-companies")}function u(y,A){var z=TeamlabMobile.regexps.crm.test(ASC.Controls.AnchorController.getLastAnchor());y={pagetitle:ASC.Resources.CrmContactInfo,title:ASC.Resources.CrmContactInfo,id:y.id,parentid:null,fromDashboard:z,back:null,item:y,phone:A.phone,email:A.email,contactTypes:A.contactTypes};if(A.hasOwnProperty("back")){y.back=A.back}var x=DefaultMobile.renderPage("crm-person-page","page-crm-person","crm-person-"+y.id,ASC.Resources.LblPerson,y)}function g(y,A){var z=TeamlabMobile.regexps.crm.test(ASC.Controls.AnchorController.getLastAnchor());y={pagetitle:ASC.Resources.CrmContactInfo,title:ASC.Resources.CrmContactInfo,id:y.id,parentid:null,fromDashboard:z,back:null,item:y,phone:A.phone,email:A.email,contactTypes:A.contactTypes};if(A.hasOwnProperty("back")){y.back=A.back}var x=DefaultMobile.renderPage("crm-company-page","page-crm-company","crm-company-"+y.id,ASC.Resources.LblCompany,y)}function r(y,A){var z=TeamlabMobile.regexps.crm.test(ASC.Controls.AnchorController.getLastAnchor());y={pagetitle:ASC.Resources.LblCrmTitle,title:ASC.Resources.LblCrmTitle,id:y.id,parentid:null,fromDashboard:z,back:null,item:y};if(A.contactId!=null){y.contactId=A.contactId}if(A.hasOwnProperty("back")){y.back=A.back}var x=DefaultMobile.renderPage("crm-task-page","page-crm-task","crm-task-"+y.id,ASC.Resources.LblCompany,y)}function l(A,z,y){data={pagetitle:ASC.Resources.BtnCrmAddTask,title:" ",type:"crm-addtask",id:A,groups:z,categories:y};var x=DefaultMobile.renderPage("crm-addtask-page","page-crm-addtask","crm-addtask"+Math.floor(Math.random()*1000000)," ",data)}function h(y,z){data={pagetitle:ASC.Resources.CrmAddCompanyPage,title:" ",type:"crm-addcompany",contact:y,contactTypes:z.contactTypes};var x=DefaultMobile.renderPage("crm-addcompany-page","page-crm-addcompany","crm-addcompany"+Math.floor(Math.random()*1000000)," ",data)}function k(z,y,A){data={pagetitle:ASC.Resources.CrmAddPersonPage,title:" ",type:"crm-addpersone",companies:y,contact:z,contactTypes:A.contactTypes,id:A.id};var x=DefaultMobile.renderPage("crm-addpersone-page","page-crm-addpersone","crm-addpersone"+Math.floor(Math.random()*1000000)," ",data)}function i(A,y,z){data={pagetitle:ASC.Resources.CrmAddHistoryEventPage,title:" ",type:"crm-addhistoryevent",id:y,category:z};var x=DefaultMobile.renderPage("crm-addhistoryevent-page","page-crm-addhistoryevent","crm-addhistoryevent"+Math.floor(Math.random()*1000000)," ",data)}function j(z,y){data={pagetitle:ASC.Resources.CrmAddDocumentPage,title:" ",type:"crm-addnote",item:y};var x=DefaultMobile.renderPage("crm-addnote-page","page-crm-addnote","crm-addnote"+Math.floor(Math.random()*1000000)," ",data)}function t(){var y={dialogtotle:ASC.Resources.LblCrmTitle,type:"crm-navigate"};var x=DefaultMobile.renderDialog("crm-navigate-dialog","dialog-crm-navigate","crm-navigate"+Math.floor(Math.random()*1000000)," ",y)}function e(z){var y={dialogtotle:ASC.Resources.LblCrmTitle,type:"crm-addtocontact",id:z};var x=DefaultMobile.renderDialog("crm-addtocontact-dialog","dialog-crm-addtocontact","crm-addtocontact"+Math.floor(Math.random()*1000000)," ",y)}function c(z){var y={dialogtotle:ASC.Resources.LblDocumentsTitle,contactid:z,fileupload:a.support.fileupload,type:"documents-additem"};var x=DefaultMobile.renderDialog("crm-additem-file-dialog","dialog-crm-additem-file","crm-additem-file"+Math.floor(Math.random()*1000000)," ",y)}function b(){var y={dialogtotle:ASC.Resources.LblCrmTitle,type:"crm-additem"};var x=DefaultMobile.renderDialog("crm-additem-dialog","dialog-crm-additem","crm-additem"+Math.floor(Math.random()*1000000)," ",y)}function w(B){var z=null,x=a();if(a("div.page-crm-contacttasks").hasClass("update-status")||a("div.page-crm-tasks").hasClass("update-status")||a("div.page-crm-task").hasClass("update-status")){if(a("div.page-crm-contacttasks").hasClass("update-status")){z=a("div.page-crm-contacttasks").removeClass("update-status");x=x.add(z.find('li.item.task[data-itemid="'+B.taskid.id+'"] input.input-checkbox.item-status'));x.parents("li.item").removeClass("update-status");$label=a('label[for="'+x.attr("id")+'"]');var y=z.find('li.item.task[data-itemid="'+B.taskid.id+'"]')||z.find('.item.task[data-itemid="'+B.taskid.id+'"]')}if(a("div.page-crm-tasks").hasClass("update-status")){z=a("div.page-crm-tasks").removeClass("update-status");x=x.add(z.find('li.item.task[data-itemid="'+B.taskid.id+'"] input.input-checkbox.item-status'));x.parents("li.item").removeClass("update-status");$label=a('label[for="'+x.attr("id")+'"]');var y=z.find('li.item.task[data-itemid="'+B.taskid.id+'"]')||z.find('.item.task[data-itemid="'+B.taskid.id+'"]')}if(a("div.page-crm-task").hasClass("update-status")){z=a("div.page-crm-task").removeClass("update-status");x=x.add(z.find("input.input-checkbox.item-status"));x.parents("li.item").removeClass("update-status");$label=null;checkboxesInd=0;checkboxesInd=x.length;while(checkboxesInd--){$checkbox=a(x[checkboxesInd]);$label=a('label[for="'+x[checkboxesInd].id+'"]')}var y=z.find('div.item.task[data-itemid="'+B.taskid.id+'"]')}}else{if(a("div.page-crm-contacttasks").hasClass("ui-page-active")){z=a("div.page-crm-contacttasks")}if(a("div.page-crm-tasks").hasClass("ui-page-active")){z=a("div.page-crm-tasks")}x=x.add(z.find('li.item.task[data-itemid="'+B.taskid.id+'"] input.input-checkbox.item-status'));x.parents("li.item").removeClass("update-status");$label=a('label[for="'+x.attr("id")+'"]');var y=z.find('li.item.task[data-itemid="'+B.taskid.id+'"]')||z.find('.item.task[data-itemid="'+B.taskid.id+'"]')}if(y.attr("data-isclosed")=="0"){for(var A=0;A<x.length;A++){a(x[A]).attr("checked",true);a('label[for="'+x[A].id+'"]').addClass("checked")}y.find("span").addClass("closed");y.attr("data-isclosed","1")}else{for(var A=0;A<x.length;A++){a(x[A]).attr("checked",false);a('label[for="'+x[A].id+'"]').removeClass("checked")}y.find("span").removeClass("closed");y.attr("data-isclosed","0")}}})(jQuery);