/*
(c) Copyright Ascensio System SIA 2010-2014

This program is a free software product.
You can redistribute it and/or modify it under the terms 
of the GNU Affero General Public License (AGPL) version 3 as published by the Free Software
Foundation. In accordance with Section 7(a) of the GNU AGPL its Section 15 shall be amended
to the effect that Ascensio System SIA expressly excludes the warranty of non-infringement of 
any third-party rights.

This program is distributed WITHOUT ANY WARRANTY; without even the implied warranty 
of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For details, see 
the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html

You can contact Ascensio System SIA at Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021.

The  interactive user interfaces in modified source and object code versions of the Program must 
display Appropriate Legal Notices, as required under Section 5 of the GNU AGPL version 3.
 
Pursuant to Section 7(b) of the License you must retain the original Product logo when 
distributing the program. Pursuant to Section 7(e) we decline to grant you any rights under 
trademark law for use of our trademarks.
 
All the Product's GUI elements, including illustrations and icon sets, as well as technical writing
content are licensed under the terms of the Creative Commons Attribution-ShareAlike 4.0
International. See the License terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
*/

window.DefaultMobile=(function(a){if(!a){console.log("Default.community: has no DefaultMobile");return a}function d(g){var h={commenttype:g.find("input.comment-type:first").removeClass("error-field").val(),id:g.find("input.comment-id:first").removeClass("error-field").val(),parentid:g.find("input.comment-parentid:first").removeClass("error-field").val(),subject:g.find("input.comment-subject:first").removeClass("error-field").val(),content:g.find("textarea.comment-content:first").removeClass("error-field").val()};for(var j in h){if(h.hasOwnProperty(j)){switch(j){case"subject":continue}h[j]=TeamlabMobile.verificationValue(h[j])}}h.parentid=h.parentid?h.parentid:"00000000-0000-0000-0000-000000000000";var i=[];for(var j in h){if(h.hasOwnProperty(j)){if(h[j]!==null){continue}switch(j){case"commenttype":i.push(g.find("input.comment-type:first").addClass("error-field"));break;case"id":i.push(g.find("input.comment-id:first").addClass("error-field"));break;case"content":i.push(g.find("textarea.comment-content:first").addClass("error-field"));break}}}if(i.length===0){return h}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}function b(g){var h={title:g.find("input.blog-title:first").removeClass("error-field").val(),content:g.find("textarea.blog-description:first").removeClass("error-field").val()||"",tags:g.find("input.blog-tags:first").removeClass("error-field").val()||""};h.tags=h.tags.split(/\s*,\s*/).join(",");for(var j in h){if(h.hasOwnProperty(j)){switch(j){case"tags":continue}h[j]=TeamlabMobile.verificationValue(h[j])}}var i=[];for(var j in h){if(h.hasOwnProperty(j)){if(h[j]!==null){continue}switch(j){case"title":i.push(g.find("input.blog-title:first").addClass("error-field"));break;case"content":i.push(g.find("textarea.blog-description:first").addClass("error-field"));break}}}if(i.length===0){return h}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}function f(g){var h={threadid:g.find("select.forum-threadid:first").removeClass("error-field").val(),subject:g.find("input.forum-title:first").removeClass("error-field").val(),content:g.find("textarea.forum-description:first").removeClass("error-field").val()||""};for(var j in h){if(h.hasOwnProperty(j)){h[j]=TeamlabMobile.verificationValue(h[j])}}var i=[];for(var j in h){if(h.hasOwnProperty(j)){if(h[j]!==null){continue}switch(j){case"threadid":i.push(g.find("select.forum-threadid:first").addClass("error-field"));break;case"subject":i.push(g.find("input.forum-title:first").addClass("error-field"));break;case"content":i.push(g.find("textarea.forum-description:first").addClass("error-field"));break}}}if(i.length===0){return h}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}function e(g){return null}function c(g){var h={url:g.find("input.bookmark-url:first").removeClass("error-field").val(),title:g.find("input.bookmark-title:first").removeClass("error-field").val(),description:g.find("textarea.bookmark-description:first").removeClass("error-field").val()||"",tags:g.find("input.bookmark-tags:first").removeClass("error-field").val()||""};h.tags=h.tags.split(/\s*,\s*/).join(",");for(var j in h){if(h.hasOwnProperty(j)){switch(j){case"description":case"tags":continue}h[j]=TeamlabMobile.verificationValue(h[j])}}var i=[];for(var j in h){if(h.hasOwnProperty(j)){if(h[j]!==null){continue}switch(j){case"url":i.push(g.find("input.bookmark-url:first").addClass("error-field"));break;case"title":i.push(g.find("input.bookmark-title:first").addClass("error-field"));break}}}if(h.hasOwnProperty("url")&&h.url){h.url=h.url.indexOf("://")===-1?"http://"+h.url:h.url}if(i.length===0){return h}ASC.Controls.messages.show(Base64.encode(ASC.Resources.ErrEmpyField),"error",ASC.Resources.ErrEmpyField);return null}a.add_community_blog_comment=function(j,h,g){var i=d(h);if(i&&TeamlabMobile.addCommunityComment("blog",i.id,i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.add_community_forum_post=function(j,h,g){var i=d(h);if(i&&TeamlabMobile.addCommunityComment("forum",i.id,i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.add_community_event_comment=function(j,h,g){var i=d(h);if(i.parentid==="00000000-0000-0000-0000-000000000000"){i.parentid=0}if(i&&TeamlabMobile.addCommunityComment("event",i.id,i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.add_community_bookmark_comment=function(j,h,g){var i=d(h);if(i&&TeamlabMobile.addCommunityComment("bookmark",i.id,i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.create_community_blog=function(j,h,g){var i=b(h);if(i&&TeamlabMobile.addCommunityItem("blog",i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.create_community_forum=function(j,h,g){var i=f(h);if(i&&TeamlabMobile.addCommunityItem("forum",i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.create_community_event=function(j,h,g){var i=e(h);if(i&&TeamlabMobile.addCommunityItem("event",i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.create_community_bookmark=function(j,h,g){var i=c(h);if(i&&TeamlabMobile.addCommunityItem("bookmark",i)){jQuery(document).trigger("changepage");g.addClass("disabled")}};a.load_more_community_items=function(i,h,g){var j=[{type:"all",classname:"filter-none"},{type:"blog",classname:"filter-blogs"},{type:"forum",classname:"filter-forums"},{type:"event",classname:"filter-events"},{type:"bookmark",classname:"filter-bookmarks"}];var k=j.length;while(k--){if(h.hasClass(j[k].classname)){TeamlabMobile.getMoreCommItems(j[k].type);h.addClass("loading-items")}}};return a})(DefaultMobile);(function(a){TeamlabMobile.bind(TeamlabMobile.events.communityPage,k);TeamlabMobile.bind(TeamlabMobile.events.loadTimelineCommItems,q);TeamlabMobile.bind(TeamlabMobile.events.blogsPage,h);TeamlabMobile.bind(TeamlabMobile.events.forumsPage,o);TeamlabMobile.bind(TeamlabMobile.events.eventsPage,m);TeamlabMobile.bind(TeamlabMobile.events.bookmarksPage,j);TeamlabMobile.bind(TeamlabMobile.events.blogPage,g);TeamlabMobile.bind(TeamlabMobile.events.forumPage,n);TeamlabMobile.bind(TeamlabMobile.events.eventPage,l);TeamlabMobile.bind(TeamlabMobile.events.bookmarkPage,i);TeamlabMobile.bind(TeamlabMobile.events.addBlogPage,b);TeamlabMobile.bind(TeamlabMobile.events.addForumPage,f);TeamlabMobile.bind(TeamlabMobile.events.addEventPage,e);TeamlabMobile.bind(TeamlabMobile.events.addBookmarkPage,c);TeamlabMobile.bind(TeamlabMobile.events.getThreads,p);TeamlabMobile.bind(TeamlabMobile.events.addCommunityComment,d);function k(s,t,r){s={pagetitle:ASC.Resources.LblCommunityTitle,type:"community-page",items:s,modules:t,allLoaded:r};DefaultMobile.renderPage("community-page","page-community","community",ASC.Resources.LblCommunityTitle,s).addClass("filter-none")}function h(t,u,s){t={pagetitle:ASC.Resources.LblBlogs,type:"community-page-blogs",items:t,modules:u,allLoaded:s};var r=DefaultMobile.renderPage("community-blogs-page","page-community-blogs","community-blogs",ASC.Resources.LblBlogs,t).addClass("filter-blogs");r.find("a.ui-btn-addblog").removeClass("ui-btn-disabled")}function o(t,u,s,v){t={pagetitle:ASC.Resources.LblForums,type:"community-page-forums",items:t,modules:u,allLoaded:s,hasThreads:v};var r=DefaultMobile.renderPage("community-forums-page","page-community-forums","community-forums",ASC.Resources.LblForums,t).addClass("filter-forums");if(v){r.find("a.ui-btn-addforum").removeClass("ui-btn-disabled")}}function m(t,u,s){t={pagetitle:ASC.Resources.LblEvents,type:"community-page-events",items:t,modules:u,allLoaded:s};var r=DefaultMobile.renderPage("community-events-page","page-community-events","community-events",ASC.Resources.LblEvents,t).addClass("filter-events");r.find("a.ui-btn-addevent").removeClass("ui-btn-disabled")}function j(t,u,s){t={pagetitle:ASC.Resources.LblBookmarks,type:"community-page-bookmarks",items:t,modules:u,allLoaded:s};var r=DefaultMobile.renderPage("community-bookmarks-page","page-community-bookmarks","community-bookmarks",ASC.Resources.LblBookmarks,t).addClass("filter-bookmarks");r.find("a.ui-btn-addbookmark").removeClass("ui-btn-disabled")}function q(u,t,s){t={items:t};var r=null;switch(u){case"all":r=a("div.page-community.filter-none");break;case"blog":r=a("div.page-community.filter-blogs");break;case"forum":r=a("div.page-community.filter-forums");break;case"event":r=a("div.page-community.filter-events");break;case"bookmark":r=a("div.page-community.filter-bookmarks");break}if(r!==null){r.removeClass("loading-items").find("ul.ui-timeline:first").append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbnewcommitems,t));DefaultMobile.renderVectorImages(r);if(s===true){r.addClass("loaded-items")}jQuery(document).trigger("updatepage")}}function g(s,t){s={pagetitle:ASC.Resources.LblCommunityTitle,title:ASC.Resources.LblCommunityTitle,id:s.id,parentid:null,back:null,item:s};if(t.hasOwnProperty("back")){s.back=t.back}var r=DefaultMobile.renderPage("community-blog-page","page-community-blog","community-blog-"+s.id,ASC.Resources.LblBlog,s);a(".ui-blog-content").find("a").addClass("target-blank")}function n(s,t){s={pagetitle:ASC.Resources.LblCommunityTitle,title:ASC.Resources.LblCommunityTitle,id:s.id,parentid:null,back:null,item:s};if(t.hasOwnProperty("back")){s.back=t.back}var r=DefaultMobile.renderPage("community-forum-page","page-community-forum","community-forum-"+s.id,ASC.Resources.LblForum,s).addClass("loaded-comments")}function l(s,t){s={pagetitle:ASC.Resources.LblCommunityTitle,title:ASC.Resources.LblCommunityTitle,id:s.id,parentid:null,back:null,item:s};if(t.hasOwnProperty("back")){s.back=t.back}var r=DefaultMobile.renderPage("community-event-page","page-community-event","community-event-"+s.id,ASC.Resources.LblEvent,s)}function i(s,t){s={pagetitle:ASC.Resources.LblCommunityTitle,title:ASC.Resources.LblCommunityTitle,id:s.id,parentid:null,back:null,item:s};if(t.hasOwnProperty("back")){s.back=t.back}var r=DefaultMobile.renderPage("community-bookmark-page","page-community-bookmark","community-bookmark-"+s.id,ASC.Resources.LblBookmark,s)}function b(s,t){s={pagetitle:ASC.Resources.LblAddBlogTitle,title:" ",type:"community-addblog"};var r=DefaultMobile.renderPage("community-addblog-page","page-community-addblog","community-addblog"+Math.floor(Math.random()*1000000)," ",s)}function f(s,t){s={pagetitle:ASC.Resources.LblAddForumTitle,title:" ",type:"community-addforum"};var r=DefaultMobile.renderPage("community-addforum-page","page-community-addforum","community-addforum"+Math.floor(Math.random()*1000000)," ",s);r.addClass("threads-loading");TeamlabMobile.getThreads()}function e(s,t){s={pagetitle:ASC.Resources.LblAddEventTitle,title:" ",type:"community-addevent"};var r=DefaultMobile.renderPage("community-addevent-page","page-community-addevent","community-addevent"+Math.floor(Math.random()*1000000),"title",s)}function c(s,t){s={pagetitle:ASC.Resources.LblAddBookmarkTitle,title:" ",type:"community-addbookmark"};var r=DefaultMobile.renderPage("community-addbookmark-page","page-community-addbookmark","community-addbookmark"+Math.floor(Math.random()*1000000)," ",s)}function d(u,v){var s=a();var t=u;if(v.hasOwnProperty("type")){switch(v.type){case"blog":s=a("div.page-community-blog.ui-page-active:first");break;case"forum":s=a("div.page-community-forum.ui-page-active:first");break;case"event":s=a("div.page-community-event.ui-page-active:first");break;case"bookmark":s=a("div.page-community-bookmark.ui-page-active:first");break}}if(s.length===0){return undefined}u={comments:[u]};var r=s.find("ul.ui-item-comments:first");if(t.parentId){r.find('li.item-comment[data-commentid="'+t.parentId+'"]:first ul.inline-comments:first').append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbcomments,u))}else{r.append(DefaultMobile.processTemplate(TeamlabMobile.templates.lbcomments,u))}jQuery(document).trigger("updatepage")}function p(s,t){s={items:s};var r=a("div.ui-page-active:first").removeClass("threads-loading");r.find("select.forum-threadid").remove();r.find("div.item-threadid:first").html(DefaultMobile.processTemplate(TeamlabMobile.templates.lbcommthreads,s));DefaultMobile.renderCustomSelects(r)}})(jQuery);